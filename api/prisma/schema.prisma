// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider     = "prisma-client"
    output       = "./generated"
    moduleFormat = "cjs"
}

datasource db {
    provider = "postgresql"
}

model User {
    id           Int           @id @default(autoincrement())
    guid         String        @unique @default(uuid()) @db.Uuid
    email        String        @unique
    firstName    String
    lastName     String
    password     String
    createdAt    DateTime      @default(now())
    updatedAt    DateTime      @updatedAt
    payments     Payment[]
    transactions Transaction[]
    sessions     Session[]
    bankAccounts BankAccount[]
}

model Session {
    id         Int      @id @default(autoincrement())
    userId     Int
    tokenId    String
    content    String
    identifier String
    createdAt  DateTime @default(now())
    updatedAt  DateTime @updatedAt
    user       User     @relation(fields: [userId], references: [id])

    @@index([userId])
}

model Transaction {
    id            Int         @id @default(autoincrement())
    guid          String      @unique @default(uuid()) @db.Uuid
    userId        Int
    bankAccountId Int
    categoryId    Int
    amount        Decimal
    description   String
    date          DateTime    @default(now())
    createdAt     DateTime    @default(now())
    updatedAt     DateTime    @updatedAt
    user          User        @relation(fields: [userId], references: [id])
    bankAccount   BankAccount @relation(fields: [bankAccountId], references: [id])
    category      Category    @relation(fields: [categoryId], references: [id])
    payments      Payment[]

    @@index([userId])
    @@index([bankAccountId])
    @@index([categoryId])
}

model Bank {
    id           Int           @id @default(autoincrement())
    guid         String        @unique @default(uuid()) @db.Uuid
    name         String
    createdAt    DateTime      @default(now())
    updatedAt    DateTime      @updatedAt
    bankAccounts BankAccount[]
}

model BankAccount {
    id            Int           @id @default(autoincrement())
    guid          String        @unique @default(uuid()) @db.Uuid
    description   String?
    bankId        Int
    userId        Int
    branchCode    String
    accountNumber String
    pixKeys       String[]
    createdAt     DateTime      @default(now())
    updatedAt     DateTime      @updatedAt
    bank          Bank          @relation(fields: [bankId], references: [id])
    user          User          @relation(fields: [userId], references: [id])
    transactions  Transaction[]
    cards         Card[]

    @@index([bankId])
    @@index([userId])
}

model Category {
    id           Int           @id @default(autoincrement())
    description  String
    type         CategoryType  @default(CREDIT)
    createdAt    DateTime      @default(now())
    updatedAt    DateTime      @updatedAt
    transactions Transaction[]
}

model PaymentMethod {
    id        Int       @id @default(autoincrement())
    name      String
    createdAt DateTime  @default(now())
    updatedAt DateTime  @updatedAt
    payments  Payment[]
}

model Payment {
    id              Int           @id @default(autoincrement())
    guid            String        @unique @default(uuid()) @db.Uuid
    userId          Int
    paymentMethodId Int
    transactionId   Int
    cardId          Int?
    amount          Decimal
    description     String
    date            DateTime      @default(now())
    createdAt       DateTime      @default(now())
    updatedAt       DateTime      @updatedAt
    card            Card?         @relation(fields: [cardId], references: [id])
    user            User          @relation(fields: [userId], references: [id])
    transaction     Transaction   @relation(fields: [transactionId], references: [id])
    paymentMethod   PaymentMethod @relation(fields: [paymentMethodId], references: [id])

    @@index([userId])
    @@index([transactionId])
    @@index([paymentMethodId])
}

model Card {
    id            Int         @id @default(autoincrement())
    guid          String      @unique @default(uuid()) @db.Uuid
    name          String
    closingDay    DateTime
    type          CardType
    description   String
    limit         Decimal
    bankAccountId Int
    createdAt     DateTime    @default(now())
    updatedAt     DateTime    @updatedAt
    bankAccount   BankAccount @relation(fields: [bankAccountId], references: [id])
    payments      Payment[]

    @@index([bankAccountId])
}

enum CategoryType {
    DEBIT
    CREDIT
}

enum CardType {
    CREDIT
    DEBIT
    CREDIT_AND_DEBIT
}
